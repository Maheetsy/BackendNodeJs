# --- 1. CREAR EL PROYECTO ---
# (Abre la terminal en la carpeta del proyecto, ej: BackendNode)

# 1.1. Inicializa el proyecto
npm init -y

# 1.2. Instala las dependencias principales
npm install express mongoose dotenv cors bcryptjs jsonwebtoken

# 1.3. Instala la dependencia de desarrollo (nodemon)
npm install nodemon --save-dev

# --- 2. CONFIGURAR EL ENTORNO ---

# 2.1. Edita 'package.json'
#    - Añade el script "dev" para que use nodemon:
#      "scripts": {
#        "start": "node server.js",
#        "dev": "nodemon server.js"
#      }

# 2.2. Crea el archivo '.env' (en la raíz)
#    - ¡Asegúrate de que la URL de Mongo INCLUYE el nombre de la BD al final!
#    - ¡Asegúrate de que JWT_SECRET sea IDÉNTICO al de FastAPI!
MONGODB_URI=mongodb+srv://user:.mongodb.net/pos_db_node
JWT_SECRET=tu-clave-secreta-larga-y-compartida
jwt_expires_in=1d

# --- 3. REVISAR PUNTOS CLAVE DEL CÓDIGO ---

# 3.1. server.js (o app.js)
#    - Carga dotenv: require('dotenv').config() (¡DEBE IR PRIMERO!)
#    - Conecta a MongoDB usando 'process.env.MONGODB_URI'.
#    - Usa los middlewares: app.use(cors()) y app.use(express.json()).
#    - Conecta las rutas con prefijos (¡ERROR CLÁSICO!):
#      app.use('/api/auth', require('./src/routes/auth.routes'));
#      app.use('/api/users', require('./src/routes/user.routes'));
#      app.use('/api/sales', require('./src/routes/sale.routes'));

# 3.2. middleware/auth.js
#    - Aquí es donde verificas el Token JWT usando 'process.env.JWT_SECRET'.

# 3.3. routes/user.routes.js (¡ERROR CLÁSICO!)
#    - La ruta de registro DEBE SER PÚBLICA.
#    - Asegúrate de que 'router.post('/register', ...)' esté *ANTES*
#      de la línea 'router.use(protect)'.

# --- 4. EJECUTAR Y PROBAR (CON POSTMAN) ---

# 4.1. Ejecuta el servidor
npm run dev

# 4.2. (Prueba 1) Registra tu primer usuario
#    - Haz un POST a: http://localhost:3000/api/users/register
#    - Body (JSON): { "name": "Admin", "email": "admin@test.com", "password": "123", "role": "admin" }

# 4.3. (Prueba 2) Inicia sesión
#    - Haz un POST a: http://localhost:3000/api/auth/login
#    - Body (JSON): { "email": "admin@test.com", "password": "123" }
#    - ¡Copia el 'token' de la respuesta!

# 4.4. (Prueba 3) Prueba una ruta protegida
#    - Haz un GET a: http://localhost:3000/api/users
#    - Pestaña 'Authorization' -> Tipo 'Bearer Token'.
#    - Pega tu token.
#    - ¡Ahora la petición debería funcionar!
